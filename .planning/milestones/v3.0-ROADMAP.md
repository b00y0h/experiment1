# Milestone v3.0: Live Experiments + Lead Tracking

**Status:** SHIPPED 2025-12-30
**Phases:** 10-14
**Total Plans:** 5

## Overview

Enable live A/B experiments with visitor tracking, variant assignment, and lead capture for landing page optimization.

## Phases

### Phase 10: Experiment Collection

**Goal**: Create Experiments collection linking variants with traffic allocation and activation rules
**Depends on**: Phase 9 (v2.0 complete)
**Plans**: 1 plan

Plans:
- [x] 10-01: Experiments collection with validation + tests

**Details:**
- Created Experiments collection with name, page, variants array, status, startDate, and endDate fields
- Implemented beforeChange validation hook enforcing traffic percentages sum to 100% when running
- All variants must belong to same page as experiment, minimum 2 variants required
- 5 integration tests covering CRUD and validation scenarios

### Phase 11: Visitor Assignment

**Goal**: Implement visitor identification and deterministic variant assignment logic
**Depends on**: Phase 10
**Plans**: 1 plan

Plans:
- [x] 11-01: Visitor ID + deterministic assignment + getAssignedVariant helper

**Details:**
- Visitor identification utility with `getOrCreateVisitorId()` using nanoid(21)
- Deterministic variant assignment using hash bucketing (visitorId + experimentId â†’ bucket 0-99)
- `getAssignedVariant()` helper combining experiment lookup, variant assignment, and page resolution
- 12 integration tests covering utility functions and end-to-end assignment flow

### Phase 12: Lead Capture

**Goal**: Add Leads collection with experiment/variant attribution and form submission handling
**Depends on**: Phase 11
**Plans**: 1 plan

Plans:
- [x] 12-01: Leads collection with attribution + tests

**Details:**
- Created Leads collection with email, name, and full experiment attribution fields
- Added formData JSON field for arbitrary additional form fields
- Implemented beforeChange hook to auto-set convertedAt timestamp
- 4 integration tests covering all lead capture scenarios

### Phase 13: Analytics Events

**Goal**: Track impressions, conversions, and custom events per variant
**Depends on**: Phase 12
**Plans**: 1 plan

Plans:
- [x] 13-01: AnalyticsEvents collection with event schema + tests

**Details:**
- Created AnalyticsEvents collection with eventType (impression/conversion/click/custom)
- Full experiment/variant/visitor attribution and optional blockId for granular tracking
- Implemented auto-timestamp hook on event creation
- 4 integration tests covering all event tracking use cases

### Phase 14: Experiment Dashboard

**Goal**: Admin UI components for viewing experiment results and activating/pausing experiments
**Depends on**: Phase 13
**Plans**: 1 plan

Plans:
- [x] 14-01: ExperimentStats component + calculateExperimentStats utility

**Details:**
- Created `calculateExperimentStats` utility for testable metrics aggregation
- Built `ExperimentStats` React Server Component showing experiment cards with per-variant tables
- Integrated component into admin dashboard via `beforeDashboard`
- 3 integration tests covering metrics calculation, status filtering, and edge cases

---

## Milestone Summary

**Key Decisions:**
- Used simple string hash for variant bucketing (sufficient for A/B traffic distribution)
- Kept visitor ID utility pure (cookie setting is caller's responsibility)
- Traffic validation only enforced when experiment status is 'running'
- Conversion rate = 0 when impressions = 0 (avoids division by zero)

**Issues Resolved:**
- None encountered during v3.0 development

**Issues Deferred:**
- Plugin extraction (future milestone)
- Advanced experiment activation UI with date scheduling

**Technical Debt Incurred:**
- None significant

---

_For current project status, see .planning/ROADMAP.md_
