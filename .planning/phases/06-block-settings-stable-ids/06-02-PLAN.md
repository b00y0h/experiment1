---
phase: 06-block-settings-stable-ids
plan: 02
type: execute
---

<objective>
Add block settings to ReusableBlocks collection and verify stable ID generation with integration tests.

Purpose: Complete block settings coverage and validate ID persistence behavior.
Output: ReusableBlocks.ts with settings on all blocks, integration tests proving ID stability.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./06-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-block-settings-stable-ids/06-RESEARCH.md
@.planning/phases/06-block-settings-stable-ids/06-01-SUMMARY.md
@dev/collections/ReusableBlocks.ts
@dev/fields/blockSettings.ts
@dev/int.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add settings to ReusableBlocks.ts blocks</name>
  <files>dev/collections/ReusableBlocks.ts</files>
  <action>
    1. Import createBlockSettings from '../fields/blockSettings'
    2. Add settings field (via createBlockSettings()) to each block in the blocks array:
       - accordionBlock
       - contentBlock
       - footerBlock
       - faqBlock
       - statsBlock
    3. Place settings group at end of each block's fields array
    4. Add collection-level beforeChange hook (same pattern as Pages.ts) to ensure blockId exists
    5. Run `pnpm generate:types` to update TypeScript types
  </action>
  <verify>pnpm generate:types succeeds, all 5 ReusableBlocks blocks have settings field</verify>
  <done>All ReusableBlocks.ts blocks include settings group with blockId and analyticsLabel fields</done>
</task>

<task type="auto">
  <name>Task 2: Integration tests for blockId generation and stability</name>
  <files>dev/int.spec.ts</files>
  <action>
    Add integration tests:
    1. "Pages: blocks get auto-generated blockId on create"
       - Create page with heroBlock (no blockId provided)
       - Verify hero[0].settings.blockId exists and is 12 chars
    2. "Pages: blockId persists on update (not regenerated)"
       - Create page with heroBlock
       - Capture the generated blockId
       - Update the page (change headline)
       - Verify blockId is unchanged
    3. "Pages: user-provided blockId is preserved"
       - Create page with heroBlock including settings.blockId = 'custom-hero-id'
       - Verify blockId equals 'custom-hero-id'
    4. "ReusableBlocks: blocks get auto-generated blockId"
       - Create reusable block with accordionBlock
       - Verify block[0].settings.blockId exists
  </action>
  <verify>pnpm test:int passes all new tests</verify>
  <done>4 new integration tests pass, proving ID auto-generation, stability, and custom ID preservation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm lint` passes
- [ ] `pnpm test:int` passes (including 4 new blockId tests)
- [ ] `pnpm generate:types` succeeds
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- blockId generation proven stable across updates
- Phase 6 complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-block-settings-stable-ids/06-02-SUMMARY.md`
</output>
