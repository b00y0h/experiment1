---
phase: 09-page-variants-shell
plan: 01
type: execute
---

<objective>
Create PageVariants collection that stores block section overrides for existing pages.

Purpose: Enable A/B testing and content personalization by defining alternate versions of page sections.
Output: PageVariants collection with hero/content/footer override arrays, plus integration tests.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./09-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@dev/collections/Pages.ts
@dev/collections/ReusableBlocks.ts
@dev/fields/blockSettings.ts
@dev/int.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PageVariants collection with override fields</name>
  <files>dev/collections/PageVariants.ts, dev/payload.config.ts</files>
  <action>
Create PageVariants collection with:
- `name` (text, required) - variant identifier (e.g., "Holiday Sale", "Mobile Optimized")
- `page` (relationship to pages, required) - the base page this variant applies to
- `status` (select: draft/active/archived, default: draft) - lifecycle state
- `heroOverride` (blocks array, same block types as Pages.hero) - replaces hero section when set
- `contentOverride` (blocks array, same block types as Pages.content) - replaces content section when set
- `footerOverride` (blocks array, same block types as Pages.footer) - replaces footer section when set

Import block definitions from Pages.ts or create shared block definitions to avoid duplication.
Use the same createBlockSettings() for all blocks to maintain blockId tracking.
Add collection-level ensureBlockIds hook like Pages.ts has (process heroOverride, contentOverride, footerOverride arrays).

Register collection in payload.config.ts.
  </action>
  <verify>pnpm generate:types succeeds, PageVariant type exists in payload-types.ts</verify>
  <done>PageVariants collection with all override fields, types generated, registered in config</done>
</task>

<task type="auto">
  <name>Task 2: Add integration tests for PageVariants CRUD</name>
  <files>dev/int.spec.ts</files>
  <action>
Add new describe block "PageVariants collection" with tests:

1. "creates variant with name and page reference" - create base page, create variant pointing to it, verify variant.page references page.id
2. "stores hero override blocks with blockIds" - create variant with heroOverride containing heroBlock, verify blockId is auto-generated
3. "stores content override blocks" - create variant with contentOverride containing contentBlock, accordionBlock, verify saved correctly
4. "stores footer override blocks" - create variant with footerOverride containing footerBlock
5. "enforces required page relationship" - attempt to create variant without page field, expect validation error

Use existing test patterns from the "Pages collection" and "ReusableBlocks collection" describe blocks.
  </action>
  <verify>pnpm test:int passes, new tests in output</verify>
  <done>5 integration tests for PageVariants CRUD, all passing</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm generate:types` succeeds
- [ ] `pnpm lint` passes
- [ ] `pnpm test:int` passes including new PageVariants tests
- [ ] PageVariant type appears in dev/payload-types.ts with correct fields
</verification>

<success_criteria>

- PageVariants collection created with name, page, status, and 3 override array fields
- All blocks in override arrays get auto-generated blockIds via hook
- 5 integration tests validate CRUD operations
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-page-variants-shell/09-01-SUMMARY.md`
</output>
